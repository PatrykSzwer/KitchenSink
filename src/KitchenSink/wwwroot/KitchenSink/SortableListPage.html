<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/juicy-draggable/juicy-draggable.html">

<template>
    <template is="dom-bind">
        <h2>Sortable list</h2>
        <div id="drop" class="table table-striped table-hover drop">
            <div style="display: table-header-group">
            <div class="table-row">
                <div class="table-cell">Name</div>
                <div class="table-cell"></div>
            </div>
            </div>

            <div style="display: table-row-group">   
                <template is="dom-repeat" items="{{model.Persons}}" as="person">
                    <juicy-draggable  class=" fixed">
                            <div class="table-row">
                                <div class="table-cell">
                                    {{person.Name}}
                                </div>
                                <div class="table-cell">
                                    <input type="image" src="/KitchenSink/images/thumbsUp.svg" disabled$="{{isFirstRow(person.OrdNumber$)}}" value="{{person.OrdNumber$::click}}" onclick="moveRow(this, true)" onmouseover="this.src = '/KitchenSink/images/thumbsUpSelected.svg';" onmouseout="this.src = '/KitchenSink/images/thumbsUp.svg';"/>
                                    <input type="image" src="/KitchenSink/images/thumbsDown.svg" disabled$="{{isLastRow(person.OrdNumber$, model.Persons)}}" value="{{person.OrdNumber$::click}}" onclick="moveRow(this, false)" onmouseover="this.src = '/KitchenSink/images/thumbsDownSelected.svg';" onmouseout="this.src = '/KitchenSink/images/thumbsDown.svg';"/>
                                </div>
                            </div>
                    </juicy-draggable>
                </template>

            </div>
        </div>
    </template>

    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.isFirstRow = function (ordNumber) {
                if (parseInt(ordNumber) === 1) {
                    return true;
                } else {
                    return false;
                }

            };

            template.isLastRow = function (ordNumber, personsArray) {
                var maxOrdNumber = personsArray.length;
                if (parseInt(ordNumber) === maxOrdNumber) {
                    return true;
                }

                return false;
            };
        })();

        function moveRow(caller, moveUp) {
            var row = caller.parentNode.parentNode,
                upperRow = row.previousElementSibling,
                lowerRow = row.nextElementSibling,
                parent = row.parentNode;

            if (moveUp) {
                caller.value--;
                caller.src = '/KitchenSink/images/thumbsUp.svg'; // Fix on unchanging icon on first row after swap
                parent.insertBefore(row, upperRow);
            } else {
                caller.value++;
                caller.src = '/KitchenSink/images/thumbsDown.svg'; // Fix on unchanging icon on last row after swap
                parent.insertBefore(lowerRow, row);
            }
        }
    </script>
</template>