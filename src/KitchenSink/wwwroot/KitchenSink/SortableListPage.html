<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/juicy-draggable/juicy-draggable.html">


<template>
    <template is="dom-bind">
        <h2>Sortable list</h2>
        <table id="myTable" class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th></th>
            </tr>
            </thead>
            <tbody id="drop">
            <template is="dom-repeat" items="{{model.Persons}}" as="person">
                <juicy-draggable>
                    <div class="drag">
                    <tr>
                        <td>{{person.Name}}</td>
                        <td>
                            <input type="image" src="/KitchenSink/images/thumbsUp.svg" disabled$="{{isFirstRow(person.OrdNumber$)}}" value="{{person.OrdNumber$::click}}" onclick="moveRow(this, true)" onmouseover="this.src = '/KitchenSink/images/thumbsUpSelected.svg';" onmouseout="this.src = '/KitchenSink/images/thumbsUp.svg';"/>
                            <input type="image" src="/KitchenSink/images/thumbsDown.svg" disabled$="{{isLastRow(person.OrdNumber$, model.Persons)}}" value="{{person.OrdNumber$::click}}" onclick="moveRow(this, false)" onmouseover="this.src = '/KitchenSink/images/thumbsDownSelected.svg';" onmouseout="this.src = '/KitchenSink/images/thumbsDown.svg';"/>
                        </td>
                    </tr>
                        </div>
                </juicy-draggable>
            </template>
            </tbody>
        </table>
    </template>

    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            template.isFirstRow = function (ordNumber) {
                if (parseInt(ordNumber) === 1) {
                    return true;
                } else {
                    return false;
                }

            };

            template.isLastRow = function (ordNumber, personsArray) {
                var maxOrdNumber = personsArray.length;
                if (parseInt(ordNumber) === maxOrdNumber) {
                    return true;
                }

                return false;
            };
        })();

        function moveRow(caller, moveUp) {
            var row = caller.parentNode.parentNode,
                upperRow = row.previousElementSibling,
                lowerRow = row.nextElementSibling,
                parent = row.parentNode;

            if (moveUp) {
                caller.value--;
                caller.src = '/KitchenSink/images/thumbsUp.svg'; // Fix on unchanging icon on first row after swap
                parent.insertBefore(row, upperRow);
            } else {
                caller.value++;
                caller.src = '/KitchenSink/images/thumbsDown.svg'; // Fix on unchanging icon on last row after swap
                parent.insertBefore(lowerRow, row);
            }
        }
    </script>
</template>